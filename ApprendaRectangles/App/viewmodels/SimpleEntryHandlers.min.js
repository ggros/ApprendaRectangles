define(["require","exports"],function(n,t){function i(){}t.test=i,ko.bindingHandlers.hasFocus={init:function(){console.log("init hasFocus")},update:function(){}},ko.bindingHandlers.rectangles={lastArray:[],doupdate:!1,stage:null,container:null,init:function(n){var t=this,i=function(){t.doupdate&&(t.doupdate=!1,t.stage.update())};t.stage=new createjs.Stage(n),t.stage.enableMouseOver(1),t.container=new createjs.Container,t.stage.addChild(t.container),t.stage.update(),t.doupdate=!1,createjs.Ticker.addEventListener("tick",i)},update:function(n,t){var i=this,r=ko.utils.unwrapObservable(t()),s=t(),f=n,e=function(n,t){n.onPress=function(r){$(f).css("cursor","pointer"),i.container.addChild(n);var u={x:n.x-r.stageX,y:n.y-r.stageY};r.onMouseMove=function(n){t.left(n.stageX+u.x),t.top(n.stageY+u.y)}},n.onMouseOver=function(){},n.onMouseOut=function(){}},u=ko.utils.compareArrays(this.lastArray,r),o=ko.utils.arrayFilter(u,function(n){return n.status=="added"}),h=ko.utils.arrayFilter(u,function(n){return n.status=="removed"});i.lastArray=ko.utils.arrayMap(r,function(n){return n}),ko.utils.arrayForEach(o,function(n){var t=n.value,f,o,u,r,s;console.log("rendering rect: "+t._rect.name),f=new createjs.Shape,o=new createjs.Text(t._rect.name,"bold 14px Arial","#FFFFFF"),o.textAlign="center",o.x=t.width()/2,o.y=-7+t.height()/2,u=t._rect.color,f.graphics.beginFill(createjs.Graphics.getRGB(u.R,u.G,u.B)).drawRect(0,0,t.width(),t.height()),r=new createjs.Container,r.x=t.left(),r.y=t.top(),r.addChild(f,o),e(r,t),i.container.addChild(r),t.left.subscribe(function(n){r.x=n,i.doupdate=!0}),t.top.subscribe(function(n){r.y=n,i.doupdate=!0}),s=function(){f.graphics.clear(),f.graphics.beginFill(createjs.Graphics.getRGB(u.R,u.G,u.B)).drawRect(0,0,t.width(),t.height()),i.stage.update()},t.width.subscribe(s),t.height.subscribe(s)}),i.doupdate=!0}}})